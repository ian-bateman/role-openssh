---
- name: install openssh
  portage: package=net-misc/openssh
  tags: packages

- name: configure sshd
  template: >
    src=sshd_config.j2
    dest=/etc/ssh/sshd_config
    owner=root group=root mode=0600
    validate="/usr/sbin/sshd -t -f %s"
  notify: restart sshd
  tags: configuration

- name: Set up multiple authorized keys
  authorized_key:
    user: gentoo
    state: present
    key: '{{ item }}'
    path: /etc/ssh/authorized_keys
  with_file:
    - public_keys/anthony.basile
    - public_keys/grant.barker
    - public_keys/nerdboy

- name: enable and start sshd
  service: name=sshd enabled=true state=started
